<div class="row my-3">
  <div class="col">
    <div class="d-flex align-items-center justify-content">
      <button class="btn btn-sm btn-outline-success rounded-5 mx-2 px-3" #searchBtn>Search</button>
    </div>

  </div>
  <div class="col">
    <div class="d-flex align-items-center justify-content-end">
      <button class="btn btn-sm btn-outline-success me-2 rounded-5 px-4" (click)="openAddModal()">Add</button>
      <button class="btn btn-sm btn-outline-primary me-2 rounded-5 px-4" (click)="openEditModal()">Edit
      </button>
      <button class="btn btn-sm btn-outline-danger me-2 rounded-5 px-4" #removeHotelBtn>Remove</button>
    </div>
  </div>
</div>

<div class="my-3">
  <table class="table table-hover align-middle">
    <thead>
    <tr>
      <th scope="col"></th>
      <th scope="col">Hotel name</th>
      <th scope="col" class="text-center">Rate</th>
      <th scope="col">Address</th>
      <th scope="col">Country</th>
      <th scope="col">City</th>
      <th scope="col">Manager</th>
      <th scope="col"></th>
    </tr>
    </thead>
    <tbody class="table-group-divider" #hotelsBlock>
      @if (displayHotels()) {
        @for (hotel of displayHotels(); track hotel.id; let i = $index) {
          <tr [attr.data-hotel-id]="hotel.id">
            <th scope="row">
              <div class="d-flex align-items-center justify-content-center">
                <input type="radio" class="form-check-input p-0 m-0 selected-flag" name="ftrEntity" disabled/>
                <div class="ms-2">{{ i + 1 }}</div>
              </div>
            </th>

            <td>{{ hotel.hotelName }}</td>
            <td>
              <div class="progress-container">
                <div class="text-center">{{ hotel.rate }}</div>
                <div class="progress" role="progressbar" aria-label="Hotel rating" aria-valuenow="25" aria-valuemin="1"
                     aria-valuemax="5">
                  <div class="progress-bar" [ngClass]="getColorRating(hotel.rate)"></div>
                </div>
              </div>
            </td>

            <td>{{ hotel.address }}</td>

            @if (hotel.country) {
              <td>{{ hotel.country.name }}</td>
            } @else {
              <td class="text-secondary">-</td>
            }

            @if (hotel.city) {
              <td>{{ hotel.city.name }}</td>
            } @else {
              <td class="text-secondary">-</td>
            }

            @if (hotel.manager) {
              <td>{{ hotel.manager.lastName }} {{ hotel.manager.firstName }}</td>
            } @else {
              <td class="text-secondary">-</td>
            }

            <td>
              @if (selectedId && selectedId === hotel.id) {
                <div class="d-flex align-items-center justify-content-center">
                  <button class="btn btn-sm btn-outline-secondary rounded-5 px-4 m-1"
                          (click)="openTagsModal()">Tags
                  </button>
                  <button class="btn btn-sm btn-outline-secondary rounded-5 px-4 m-1"
                          (click)="openImageModal()">Images
                  </button>
                  <button class="btn btn-sm btn-outline-secondary rounded-5 px-4 m-1"
                          (click)="openDescriptionModal()">Description
                  </button>
                </div>
              } @else {
                <div class="d-flex align-items-center justify-content-center">
                  <button class="btn btn-sm btn-outline-secondary rounded-5 px-4 m-1">Tags</button>
                  <button class="btn btn-sm btn-outline-secondary rounded-5 px-4 m-1">Images</button>
                  <button class="btn btn-sm btn-outline-secondary rounded-5 px-4 m-1">Description</button>
                </div>
              }

            </td>
          </tr>
        }

      } @else {
        <tr>
          <td colspan="9">
            <div class="d-flex align-items-center justify-content-center mt-3">
              @if (this.loadingFailed()) {
                <span class="fs-4">List is empty</span>
              } @else {
                <div class="spinner-border text-secondary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              }
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>

  @if (selectedHotel) {
    <dialog class="custom-dialog" #TagsDialog>
      <div class="d-flex align-items-center justify-content-end my-3 pe-3">
        <button class="btn-close" (click)="closeTagsModal()"></button>
      </div>
      <div class="row row-cols-1 p-5">
        @if (selectedHotel.tags && selectedHotel.tags.length > 0) {
          @for (tag of selectedHotel.tags; track tag.id; let i = $count) {
            <div class="col">
              <span>{{ i }}</span> <span>{{ tag.tagName }}</span>
              <span>
              <img ngSrc="{{tag.tagImageUrl}}" alt="tag image" width="24" height="24">
            </span>
            </div>
          }
        } @else {
          <div class="col">
            <div class="fw-semibold fs-4 text-center text-secondary">The selected hotel has no tags</div>
          </div>
        }

      </div>
    </dialog>

    <dialog class="custom-dialog" #DescriptionDialog>
      <div class="d-flex align-items-center justify-content-end my-3 pe-3">
        <button class="btn-close" (click)="closeDescriptionModal()"></button>
      </div>
      @if (selectedHotel.description && selectedHotel.description.trim() !== "") {
        <div class="d-flex align-items-center p-5 w-100">{{ selectedHotel.description }}</div>
      } @else {
        <div class="fw-semibold fs-4 text-center text-secondary">The selected hotel has no description</div>
      }
    </dialog>

    <dialog class="custom-dialog" #ImageDialog>
      <div class="d-flex align-items-center justify-content-end my-3 pe-3">
        <button class="btn-close" (click)="closeImageModal()"></button>
      </div>

      @if (selectedHotel.images && selectedHotel.images.length > 0) {
        <div class="carousel-admin-container">
          <div id="hotelImagesCarousel" class="carousel carousel-fade">
            <div class="carousel-inner">
              @for (image of selectedHotel.images; track image.id; let i = $index) {
                @if (i === 0) {
                  <div class="carousel-item active">
                    <img src="{{image.url}}" alt="Hotel image">
                  </div>
                } @else {
                  <div class="carousel-item">
                    <img src="{{image.url}}" alt="Hotel image">
                  </div>
                }
              }
            </div>
            <button class="carousel-control-prev" id="cr_btn_prev" type="button" data-bs-target="#hotelImagesCarousel"
                    data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" id="cr_btn_next" type="button" data-bs-target="#hotelImagesCarousel"
                    data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
      } @else {
        <div class="fw-semibold fs-4 text-center text-secondary">The selected hotel has no images</div>
      }

    </dialog>
  }

</div>
